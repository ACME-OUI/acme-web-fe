{% extends "base.html" %}
{% block title %} work flow code{% endblock %}

{% block content %}
{% include "acme_site/acme_sidebars/sidebar_left.html" %}
{% include "acme_site/acme_sidebars/sidebar_right.html" %}

<link href="/acme/static/filetree/jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />

<script src="/acme/static/filetree/jqueryFileTree.js" type="text/javascript"></script>
<!--
<script src="/acme/static/js/nicEdit-latest.js" type="text/javascript"></script>
<script type="text/javascript">bkLib.onDomLoaded(nicEditors.allTextAreas);</script>
-->
<script>
  $(document).ready( function() {
    whole = document.URL;
    parts = whole.split("=");
    path = parts[1].split("/");
    dir = path[path.length - 2];

    $('#wfname').html(dir);

    $('#usertree').fileTree({ root: parts[1] }, function(file) {
      // get file contents and put in text area
      url = "/acme/getfile"
      var jsonObj = new Object;
      jsonObj.filepath = file;
      var jsonStr = JSON.stringify(jsonObj);
      
      $.ajax({
        type: "POST",
        url: url,
        data: {filename:jsonStr},
        dataType: 'json',
        success: function(data){
          filecontent = data.key
          //nicEditors.findEditor('textarea').setContent(filecontent)
          alert("here");
          //$(this).parent().css("background-color","green");
          $("#textarea").text(filecontent)
        },
        error: function(request, status, error){
          alert(request + " | " +  status + " | " +  error);  
        }
      });
    }, function(dir){
      // do ALL the things
    }); 
  });
</script>

<div id="center">
  {% include "acme_site/work_flows/work_flow_blank.html" %}
  <h3>Code</h3>
  <br/>

  <div id="usertree" style="float: left; width: 25%"></div>
  
  <div id="textareadiv" style="float: right; width: 75%;">
    <form>
      <textarea name="textarea" id="textarea" wrap="off" style="width: 100%; min-height: 550px"></textarea>
      <br/>
      <input type="submit"/>
    </form>
  </div>

</div>
{% endblock %}
